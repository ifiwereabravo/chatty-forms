{"version":3,"file":"frontend.js","mappings":"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","sources":["webpack://chatty-forms/./src/frontend.js"],"sourcesContent":["import './frontend.scss';\n\n// â”€â”€â”€ Photo Upload Field â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nclass ChattyPhotoField {\n    constructor(container) {\n        this.container = container;\n        this.fieldId = container.dataset.fieldId;\n        this.maxPhotos = parseInt(container.dataset.maxPhotos) || 1;\n        this.isRequired = container.dataset.required === '1';\n        this.apiUrl = container.dataset.apiUrl;\n        this.nonce = container.dataset.nonce;\n        this.photos = []; // { id, url, file, uploading }\n        this.dragIndex = null;\n        this.init();\n    }\n\n    init() {\n        this.container.innerHTML = '';\n        this.grid = document.createElement('div');\n        this.grid.className = 'chatty-photo-grid';\n        this.container.appendChild(this.grid);\n        this.renderGrid();\n    }\n\n    renderGrid() {\n        this.grid.innerHTML = '';\n\n        // Render existing photo thumbnails\n        this.photos.forEach((photo, index) => {\n            const thumb = document.createElement('div');\n            thumb.className = 'chatty-photo-thumb' + (photo.uploading ? ' uploading' : '');\n            thumb.draggable = true;\n            thumb.dataset.index = index;\n\n            // Drag events for rearranging\n            thumb.addEventListener('dragstart', (e) => {\n                this.dragIndex = index;\n                thumb.classList.add('chatty-photo-dragging');\n                e.dataTransfer.effectAllowed = 'move';\n            });\n            thumb.addEventListener('dragend', () => {\n                thumb.classList.remove('chatty-photo-dragging');\n                this.dragIndex = null;\n            });\n            thumb.addEventListener('dragover', (e) => {\n                e.preventDefault();\n                e.dataTransfer.dropEffect = 'move';\n                thumb.classList.add('drag-over');\n            });\n            thumb.addEventListener('dragleave', () => {\n                thumb.classList.remove('drag-over');\n            });\n            thumb.addEventListener('drop', (e) => {\n                e.preventDefault();\n                thumb.classList.remove('drag-over');\n                if (this.dragIndex !== null && this.dragIndex !== index) {\n                    const moved = this.photos.splice(this.dragIndex, 1)[0];\n                    this.photos.splice(index, 0, moved);\n                    this.renderGrid();\n                }\n            });\n\n            // Touch drag for mobile\n            thumb.addEventListener('touchstart', (e) => {\n                this.dragIndex = index;\n                thumb.classList.add('chatty-photo-dragging');\n            }, { passive: true });\n            thumb.addEventListener('touchend', () => {\n                thumb.classList.remove('chatty-photo-dragging');\n                this.dragIndex = null;\n            });\n\n            const img = document.createElement('img');\n            img.src = photo.url;\n            img.alt = `Photo ${index + 1}`;\n            thumb.appendChild(img);\n\n            // Uploading spinner\n            if (photo.uploading) {\n                const spinner = document.createElement('div');\n                spinner.className = 'chatty-photo-spinner';\n                spinner.innerHTML = 'â³';\n                thumb.appendChild(spinner);\n            }\n\n            // Delete button\n            if (!photo.uploading) {\n                const del = document.createElement('button');\n                del.type = 'button';\n                del.className = 'chatty-photo-delete';\n                del.innerHTML = 'âœ•';\n                del.addEventListener('click', (e) => {\n                    e.stopPropagation();\n                    this.photos.splice(index, 1);\n                    this.renderGrid();\n                });\n                thumb.appendChild(del);\n            }\n\n            // Photo number badge\n            const badge = document.createElement('span');\n            badge.className = 'chatty-photo-badge';\n            badge.textContent = index + 1;\n            thumb.appendChild(badge);\n\n            this.grid.appendChild(thumb);\n        });\n\n        // Add \"+\" slot if under max\n        if (this.photos.length < this.maxPhotos) {\n            const addSlot = document.createElement('div');\n            addSlot.className = 'chatty-photo-add';\n            addSlot.innerHTML = '<span class=\"chatty-photo-add-icon\">ðŸ“·</span><span class=\"chatty-photo-add-label\">+</span>';\n            addSlot.addEventListener('click', () => this.openCamera());\n\n            // Also accept drop on the add slot for rearranging\n            addSlot.addEventListener('dragover', (e) => { e.preventDefault(); });\n            addSlot.addEventListener('drop', (e) => {\n                e.preventDefault();\n                if (this.dragIndex !== null) {\n                    const moved = this.photos.splice(this.dragIndex, 1)[0];\n                    this.photos.push(moved);\n                    this.renderGrid();\n                }\n            });\n\n            this.grid.appendChild(addSlot);\n        }\n\n        // Hidden input for form validation (required check)\n        let hiddenInput = this.container.querySelector('.chatty-photo-hidden');\n        if (!hiddenInput) {\n            hiddenInput = document.createElement('input');\n            hiddenInput.type = 'hidden';\n            hiddenInput.className = 'chatty-photo-hidden';\n            hiddenInput.name = this.fieldId;\n            this.container.appendChild(hiddenInput);\n        }\n        hiddenInput.value = this.getUrls().join(',');\n        if (this.isRequired && this.photos.length === 0) {\n            hiddenInput.setCustomValidity('Please add at least one photo.');\n        } else {\n            hiddenInput.setCustomValidity('');\n        }\n    }\n\n    openCamera() {\n        const input = document.createElement('input');\n        input.type = 'file';\n        input.accept = 'image/*';\n        input.capture = 'environment';\n        input.style.display = 'none';\n        document.body.appendChild(input);\n\n        input.addEventListener('change', () => {\n            if (input.files && input.files[0]) {\n                this.showPreview(input.files[0]);\n            }\n            document.body.removeChild(input);\n        });\n\n        input.click();\n    }\n\n    showPreview(file) {\n        const reader = new FileReader();\n        reader.onload = (e) => {\n            const dataUrl = e.target.result;\n\n            // Create full-width preview overlay\n            const overlay = document.createElement('div');\n            overlay.className = 'chatty-photo-preview-overlay';\n\n            const previewImg = document.createElement('img');\n            previewImg.src = dataUrl;\n            previewImg.className = 'chatty-photo-preview-img';\n            overlay.appendChild(previewImg);\n\n            const actions = document.createElement('div');\n            actions.className = 'chatty-photo-preview-actions';\n\n            const retakeBtn = document.createElement('button');\n            retakeBtn.type = 'button';\n            retakeBtn.className = 'chatty-photo-retake-btn';\n            retakeBtn.innerHTML = 'â†» Retake';\n            retakeBtn.addEventListener('click', () => {\n                overlay.remove();\n                this.openCamera();\n            });\n\n            const saveBtn = document.createElement('button');\n            saveBtn.type = 'button';\n            saveBtn.className = 'chatty-photo-save-btn';\n            saveBtn.innerHTML = 'âœ“ Save';\n            saveBtn.addEventListener('click', () => {\n                overlay.remove();\n                this.addPhoto(file, dataUrl);\n            });\n\n            actions.appendChild(retakeBtn);\n            actions.appendChild(saveBtn);\n            overlay.appendChild(actions);\n\n            this.container.appendChild(overlay);\n        };\n        reader.readAsDataURL(file);\n    }\n\n    async addPhoto(file, dataUrl) {\n        const tempId = 'temp_' + Date.now();\n        const photo = { id: tempId, url: dataUrl, uploading: true };\n        this.photos.push(photo);\n        this.renderGrid();\n\n        try {\n            const formData = new FormData();\n            formData.append('photo', file);\n\n            const response = await fetch(this.apiUrl, {\n                method: 'POST',\n                headers: { 'X-WP-Nonce': this.nonce },\n                body: formData,\n            });\n\n            const result = await response.json();\n\n            if (!response.ok) {\n                throw new Error(result.message || 'Upload failed');\n            }\n\n            // Update with server URL\n            const idx = this.photos.findIndex(p => p.id === tempId);\n            if (idx !== -1) {\n                this.photos[idx] = { id: result.id, url: result.url, uploading: false };\n            }\n        } catch (err) {\n            console.error('[CHATTY Forms] Photo upload failed:', err);\n            // Remove failed photo\n            const idx = this.photos.findIndex(p => p.id === tempId);\n            if (idx !== -1) this.photos.splice(idx, 1);\n        }\n\n        this.renderGrid();\n    }\n\n    getUrls() {\n        return this.photos.filter(p => !p.uploading).map(p => p.url);\n    }\n\n    isUploading() {\n        return this.photos.some(p => p.uploading);\n    }\n}\n\ndocument.addEventListener('DOMContentLoaded', () => {\n    // â”€â”€â”€ Standalone Visitor ID â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n    // If chatty-core isn't present, Forms generates its own visitor cookie\n    // so the visitor_id persists across sessions before contact info is submitted.\n    if (!getCookie('chatty_visitor_id')) {\n        const vid = 'cf_' + crypto.randomUUID();\n        document.cookie = `chatty_visitor_id=${vid};path=/;max-age=${365 * 24 * 60 * 60};SameSite=Lax`;\n    }\n\n    const wrappers = document.querySelectorAll('.chatty-form-wrapper');\n\n    wrappers.forEach(wrapper => {\n        const form = wrapper.querySelector('.chatty-form');\n        const gate = wrapper.querySelector('.chatty-form-gate');\n        const downloadSection = wrapper.querySelector('.chatty-form-download');\n        const downloadBtn = downloadSection?.querySelector('.chatty-form-download-btn');\n\n        // Initialize photo fields\n        const photoFields = [];\n        wrapper.querySelectorAll('.chatty-form-photo-field').forEach(container => {\n            photoFields.push(new ChattyPhotoField(container));\n        });\n\n        // Read settings from data attributes\n        const config = {\n            formId: wrapper.dataset.formId,\n            delivery: wrapper.dataset.delivery || 'message',\n            gate: wrapper.dataset.gate || 'none',\n            downloadUrl: wrapper.dataset.download || '',\n            redirectUrl: wrapper.dataset.redirect || '',\n            successMsg: wrapper.dataset.successMsg || 'Thank you!',\n            shareText: wrapper.dataset.shareText || '',\n            shareUrl: wrapper.dataset.shareUrl || window.location.href,\n        };\n\n        // Social login buttons\n        const socialBtns = wrapper.querySelectorAll('.chatty-form-social-btn');\n        socialBtns.forEach(btn => {\n            btn.addEventListener('click', () => {\n                const provider = btn.dataset.provider;\n                handleSocialLogin(provider, form);\n            });\n        });\n\n        // Form submission\n        form.addEventListener('submit', async (e) => {\n            e.preventDefault();\n            const messageContainer = form.querySelector('.chatty-form-message');\n            const submitBtn = form.querySelector('button[type=\"submit\"]');\n\n            messageContainer.innerHTML = '';\n            messageContainer.className = 'chatty-form-message';\n            submitBtn.disabled = true;\n            submitBtn.textContent = 'Submitting...';\n\n            const formData = new FormData(form);\n            const data = {};\n            formData.forEach((value, key) => {\n                // Handle checkbox arrays\n                if (key.endsWith('[]')) {\n                    const cleanKey = key.slice(0, -2);\n                    if (!data[cleanKey]) data[cleanKey] = [];\n                    data[cleanKey].push(value);\n                } else {\n                    data[key] = value;\n                }\n            });\n\n            // Inject photo field URLs into data\n            photoFields.forEach(pf => {\n                const urls = pf.getUrls();\n                if (urls.length > 0) {\n                    data[pf.fieldId] = urls;\n                }\n            });\n\n            // Block submit if photos are still uploading\n            if (photoFields.some(pf => pf.isUploading())) {\n                messageContainer.innerHTML = 'Photos are still uploading, please wait...';\n                messageContainer.classList.add('info');\n                submitBtn.disabled = false;\n                submitBtn.textContent = 'Submit';\n                return;\n            }\n\n            // Read chatty_visitor_id cookie for identity resolution\n            const visitorId = getCookie('chatty_visitor_id');\n\n            try {\n                const response = await fetch(chattyFormsFrontend.apiUrl + '/submit', {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json',\n                        'X-WP-Nonce': chattyFormsFrontend.nonce\n                    },\n                    body: JSON.stringify({\n                        form_id: config.formId,\n                        data: data,\n                        visitor_id: visitorId || ''\n                    })\n                });\n\n                const result = await response.json();\n\n                if (!response.ok) {\n                    throw new Error(result.message || 'Submission failed');\n                }\n\n                // Handle delivery\n                if (config.gate !== 'none' && config.gate !== 'form_only') {\n                    // Gate active â€” show gate overlay\n                    form.style.display = 'none';\n                    if (gate) {\n                        gate.style.display = 'block';\n                        setupShareButtons(wrapper, config);\n                    }\n                } else if (config.delivery === 'redirect' && config.redirectUrl) {\n                    messageContainer.innerHTML = 'Redirecting...';\n                    messageContainer.classList.add('success');\n                    setTimeout(() => {\n                        window.location.href = config.redirectUrl;\n                    }, 500);\n                } else if (config.delivery === 'download' && config.downloadUrl) {\n                    form.style.display = 'none';\n                    showDownload(wrapper, config);\n                } else {\n                    messageContainer.innerHTML = config.successMsg;\n                    messageContainer.classList.add('success');\n                    form.reset();\n                }\n            } catch (error) {\n                messageContainer.innerHTML = error.message;\n                messageContainer.classList.add('error');\n            } finally {\n                submitBtn.disabled = false;\n                submitBtn.textContent = 'Submit';\n            }\n        });\n    });\n});\n\n/**\n * Read a cookie by name\n */\nfunction getCookie(name) {\n    const match = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));\n    return match ? decodeURIComponent(match[2]) : '';\n}\n\nfunction setupShareButtons(wrapper, config) {\n    const shareBtns = wrapper.querySelectorAll('.chatty-share-btn');\n    shareBtns.forEach(btn => {\n        btn.addEventListener('click', () => {\n            const platform = btn.dataset.platform;\n            const text = encodeURIComponent(config.shareText || document.title);\n            const url = encodeURIComponent(config.shareUrl || window.location.href);\n            let shareUrl = '';\n\n            switch (platform) {\n                case 'facebook':\n                    shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${url}`;\n                    break;\n                case 'twitter':\n                    shareUrl = `https://twitter.com/intent/tweet?text=${text}&url=${url}`;\n                    break;\n                case 'linkedin':\n                    shareUrl = `https://www.linkedin.com/shareArticle?mini=true&url=${url}&title=${text}`;\n                    break;\n            }\n\n            if (shareUrl) {\n                // Open share dialog\n                const popup = window.open(shareUrl, 'share', 'width=600,height=400,scrollbars=yes');\n\n                // Mark as shared (intent-based â€” we can't verify actual shares)\n                btn.classList.add('shared');\n                btn.innerHTML = 'âœ“ Shared';\n\n                // Unlock content after share\n                sessionStorage.setItem(`chatty-shared-${config.formId}`, '1');\n\n                // Show download after a brief delay\n                setTimeout(() => {\n                    const gate = wrapper.querySelector('.chatty-form-gate');\n                    if (gate) gate.style.display = 'none';\n                    showDownload(wrapper, config);\n                }, 1500);\n            }\n        });\n    });\n}\n\nfunction showDownload(wrapper, config) {\n    const downloadSection = wrapper.querySelector('.chatty-form-download');\n    const downloadBtn = downloadSection?.querySelector('.chatty-form-download-btn');\n\n    if (downloadSection && downloadBtn && config.downloadUrl) {\n        downloadBtn.href = config.downloadUrl;\n        downloadSection.style.display = 'block';\n        downloadSection.classList.add('visible');\n    } else {\n        // No download, show success message\n        const form = wrapper.querySelector('.chatty-form');\n        const msg = form.querySelector('.chatty-form-message');\n        if (msg) {\n            msg.innerHTML = config.successMsg;\n            msg.classList.add('success');\n        }\n        form.style.display = 'block';\n    }\n}\n\nfunction handleSocialLogin(provider, form) {\n    // Stub â€” OAuth integration will be implemented in Phase B\n    // For now, show a message that OAuth needs API credentials\n    const msg = form.querySelector('.chatty-form-message');\n    if (msg) {\n        msg.innerHTML = `Social login with ${provider} requires OAuth credentials. Configure in CHATTY Forms â†’ Settings.`;\n        msg.className = 'chatty-form-message info';\n    }\n\n    console.log(`[CHATTY Forms] Social login initiated for: ${provider}`);\n    console.log('[CHATTY Forms] OAuth flow will be available after API credentials are configured.');\n}\n"],"names":["ChattyPhotoField","constructor","container","this","fieldId","dataset","maxPhotos","parseInt","isRequired","required","apiUrl","nonce","photos","dragIndex","init","innerHTML","grid","document","createElement","className","appendChild","renderGrid","forEach","photo","index","thumb","uploading","draggable","addEventListener","e","classList","add","dataTransfer","effectAllowed","remove","preventDefault","dropEffect","moved","splice","passive","img","src","url","alt","spinner","del","type","stopPropagation","badge","textContent","length","addSlot","openCamera","push","hiddenInput","querySelector","name","value","getUrls","join","setCustomValidity","input","accept","capture","style","display","body","files","showPreview","removeChild","click","file","reader","FileReader","onload","dataUrl","target","result","overlay","previewImg","actions","retakeBtn","saveBtn","addPhoto","readAsDataURL","tempId","Date","now","id","formData","FormData","append","response","fetch","method","headers","json","ok","Error","message","idx","findIndex","p","err","console","error","filter","map","isUploading","some","getCookie","match","cookie","RegExp","decodeURIComponent","showDownload","wrapper","config","downloadSection","downloadBtn","downloadUrl","href","form","msg","successMsg","vid","crypto","randomUUID","querySelectorAll","gate","photoFields","formId","delivery","download","redirectUrl","redirect","shareText","shareUrl","window","location","btn","provider","log","handleSocialLogin","async","messageContainer","submitBtn","disabled","data","key","endsWith","cleanKey","slice","pf","urls","visitorId","chattyFormsFrontend","JSON","stringify","form_id","visitor_id","platform","text","encodeURIComponent","title","open","sessionStorage","setItem","setTimeout","setupShareButtons","reset"],"sourceRoot":""}