(()=>{"use strict";function e(e,t){const s=e.querySelector(".chatty-form-download"),o=s?.querySelector(".chatty-form-download-btn");if(s&&o&&t.downloadUrl)o.href=t.downloadUrl,s.style.display="block",s.classList.add("visible");else{const s=e.querySelector(".chatty-form"),o=s.querySelector(".chatty-form-message");o&&(o.innerHTML=t.successMsg,o.classList.add("success")),s.style.display="block"}}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".chatty-form-wrapper").forEach(t=>{const s=t.querySelector(".chatty-form"),o=t.querySelector(".chatty-form-gate"),r=t.querySelector(".chatty-form-download"),a=(r?.querySelector(".chatty-form-download-btn"),{formId:t.dataset.formId,delivery:t.dataset.delivery||"message",gate:t.dataset.gate||"none",downloadUrl:t.dataset.download||"",redirectUrl:t.dataset.redirect||"",successMsg:t.dataset.successMsg||"Thank you!",shareText:t.dataset.shareText||"",shareUrl:t.dataset.shareUrl||window.location.href});t.querySelectorAll(".chatty-form-social-btn").forEach(e=>{e.addEventListener("click",()=>{!function(e,t){const s=t.querySelector(".chatty-form-message");s&&(s.innerHTML=`Social login with ${e} requires OAuth credentials. Configure in CHATTY Forms → Settings.`,s.className="chatty-form-message info"),console.log(`[CHATTY Forms] Social login initiated for: ${e}`),console.log("[CHATTY Forms] OAuth flow will be available after API credentials are configured.")}(e.dataset.provider,s)})}),s.addEventListener("submit",async r=>{r.preventDefault();const n=s.querySelector(".chatty-form-message"),c=s.querySelector('button[type="submit"]');n.innerHTML="",n.className="chatty-form-message",c.disabled=!0,c.textContent="Submitting...";const l=new FormData(s),i={};l.forEach((e,t)=>{if(t.endsWith("[]")){const s=t.slice(0,-2);i[s]||(i[s]=[]),i[s].push(e)}else i[t]=e});try{const r=await fetch(chattyFormsFrontend.apiUrl+"/submit",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":chattyFormsFrontend.nonce},body:JSON.stringify({form_id:a.formId,data:i})}),c=await r.json();if(!r.ok)throw new Error(c.message||"Submission failed");"none"!==a.gate&&"form_only"!==a.gate?(s.style.display="none",o&&(o.style.display="block",function(t,s){t.querySelectorAll(".chatty-share-btn").forEach(o=>{o.addEventListener("click",()=>{const r=o.dataset.platform,a=encodeURIComponent(s.shareText||document.title),n=encodeURIComponent(s.shareUrl||window.location.href);let c="";switch(r){case"facebook":c=`https://www.facebook.com/sharer/sharer.php?u=${n}`;break;case"twitter":c=`https://twitter.com/intent/tweet?text=${a}&url=${n}`;break;case"linkedin":c=`https://www.linkedin.com/shareArticle?mini=true&url=${n}&title=${a}`}c&&(window.open(c,"share","width=600,height=400,scrollbars=yes"),o.classList.add("shared"),o.innerHTML="✓ Shared",sessionStorage.setItem(`chatty-shared-${s.formId}`,"1"),setTimeout(()=>{const o=t.querySelector(".chatty-form-gate");o&&(o.style.display="none"),e(t,s)},1500))})})}(t,a))):"redirect"===a.delivery&&a.redirectUrl?(n.innerHTML="Redirecting...",n.classList.add("success"),setTimeout(()=>{window.location.href=a.redirectUrl},500)):"download"===a.delivery&&a.downloadUrl?(s.style.display="none",e(t,a)):(n.innerHTML=a.successMsg,n.classList.add("success"),s.reset())}catch(e){n.innerHTML=e.message,n.classList.add("error")}finally{c.disabled=!1,c.textContent="Submit"}})})})})();